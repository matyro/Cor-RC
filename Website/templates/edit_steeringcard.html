{% include "header.html" %}

<style type="text/css">
.col-md-3{	
    display: table-cell;    
	height: 100%;
	width: 23%;
}
.col-md-9{	
    display: table-cell;  
	height: 100%;
	width: 73%;	
}
.panel{
	max-height: 85vh;
	height: 85vh;	
}

.panel-body{
	height: 100%;
	max-height: 100%;		
}

.panel-heading .accordion-toggle:after {
    /* symbol for "opening" panels */
    font-family: 'Glyphicons Halflings';  /* essential for enabling glyphicon */
    content: "\e114";    /* adjust as needed, taken from bootstrap.css */
    float: right;        /* adjust as needed */
    color: grey;         /* adjust as needed */
}
.panel-heading .accordion-toggle.collapsed:after {
    /* symbol for "collapsed" panels */
    content: "\e080";    /* adjust as needed, taken from bootstrap.css */
}

.ui-state-highlight { 
	height: 1.5em;
	line-height: 1.2em;
	margin: 8px;
}

.trash{	
	background-color: lightgrey;
	border-radius: 10px;
}
.trash_highlight{	
	background-color: red;
	border-radius: 10px;
}


label {
	display: inline-block;
	width: 5em;
}


.ui-tooltip {
    background: black;
    color: white;
    border: none;
    padding: 0;
    opacity: 0.8;
	
	text-align:center;	
	
	border-radius: 0px;
	font: bold 12px "Helvetica Neue", Sans-Serif;
    text-transform: uppercase;
    box-shadow: 0 0 7px darkgrey;
}
.ui-tooltip-content {
    position: relativ;
    padding: 1em;
}
.ui-tooltip-content::after {
    content: '';
    position: absolute;
    border-style: solid;
    display: block;
    width: 0;
}
.noarrow-tooltip .ui-tooltip-content::after {
	display: none;
}
.right-tooltip .ui-tooltip-content::after {
    top: 18px;
    left: -10px;
    border-color: transparent black;
    border-width: 10px 10px 10px 0; /*top, right, bottom, left */
}
.left-tooltip .ui-tooltip-content::after {
    top: 18px;
    right: -10px;
    border-color: transparent black;
    border-width: 10px 0 10px 10px;
}
.top-tooltip .ui-tooltip-content::after {
    bottom: -10px;
    left: 72px;
    border-color: black transparent;
    border-width: 10px 10px 0;    
}
.bottom-tooltip .ui-tooltip-content::after {
    top: -10px;
    left: 72px;
    border-color: black transparent;
    border-width: 0 10px 10px;		/* top, right&left, bottom */
}


input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}
input[type="number"] {
    -moz-appearance: textfield;
}
</style>


<div class="container">
	<div class="row">

		<div class="col-md-3 panel pull-left" style="padding-left:0px; padding-right:0px;">		
			<div class="panel-heading">		
				<a class="panel-title"> Select settings to add: </a>
			</div>
			<div class="panel-body">
			
				<div style="max-height:80%; padding:10px; border-width: 1px; border-style: solid; border-color: darkgrey; overflow-y:scroll;">
				<ul id="collectionList" class="list-unstyled no-float">
				{% for itr in steering %}
					<li class="group" style="margin:2px">							
						<h3 class="deactivate">
							{{itr.name}}
							<div class="tt trash pull-right" title="{% raw itr.desc %}">
								<i class="fa fa-question fa-lg" aria-hidden="true"></i>
							</div>
						</h3>	
						<div >
							{% raw itr.content %}
						</div>
					</li>
				{% end %}					
				</ul>
				</div>
				<form id="form1" action="/edit_card" method="POST" role="form" style="margin-top: 10px; margin-bottom: 10px;">
					{% raw xsrf_form_html() %}
					<input type="text" name="filename" class="form-control input-lg" placeholder="Filename"></input>				
				</form>				
				<button class="btn btn-success btn-block" id="savebutton">Save</button>
			</div>
		</div>	

		<div class="col-md-9 no-float panel panel-default pull-right" style="overflow-y:scroll; padding-left:0px; padding-right:0px;">
			<div class="panel-heading clearfix">	
				<h2 class="panel-title pull-left" style="padding-top: 7.5px;"><b>Steering Card:</b></h2>
				<div id="trash" class="trash pull-right" title="Pull elements over it to remove them!">
					<a><i class="fa fa-trash fa-3x" aria-hidden="true"></i></a>
				</div>					
			</div>
			
			<form id="form2" action="/edit_card" method="POST" role="form">

				<ul id="steeringList" class="panel-group list-unstyled" style="padding:20px;">				
				</ul>
				{% raw xsrf_form_html() %}
				<input id="steering" name="steering" type="hidden" value=""></input>				
			</form>

		</div>

	</div>
</div>

<script>
    $( function(){
		
	
	$('.tt').mouseover(function(e) {
		$(this).tooltip({
				items: '.tt',				
				position: {
			my: "right center",
			at: "right-20 center",
			offset: "-40 0",
			of: $(this).parent()
		},
		relative: true,
		tooltipClass: "noarrow-tooltip" });
		$(this).tooltip("open");
		
	}).mouseleave(function() {
		$(this).tooltip("destroy");
	}).mousedown(function() {
		$(this).tooltip("destroy");
	});

	
    $( "#steeringList" ).sortable({		
		placeholder: "ui-state-highlight",	
		axis: "y",
		receive: function(e,ui) {			
            copyHelper = null;		
			
			var input = $( "#steering" );
			input.val($(this).find("h3").text().trim().replace(/(\r\n|\n|\r)+/gm,",") );
			
			$(this).find("h3").removeClass("deactivate");
			$(".accordion").accordion( "refresh" );			
        },
		stop: function( event, ui ) {
			ui.item.children( "h3" ).triggerHandler( "focusout" );				
			
			// Refresh accordion to handle new order
			$(".accordion").accordion( "refresh" );			
		}
    }).accordion({
		header: "> li > h3",
		active: false,
		collapsible: true,
		heightStyle: "content",
		autoHeight: true
	});
	
	$( "#collectionList" ).sortable({	
		connectWith: "#steeringList" ,
		forcePlaceholderSize: false,
		placeholder: "ui-state-highlight",		
		helper: function(e,li) {
			copyHelper = li.clone(true,true).insertAfter(li);
			
			var tmp = li.clone(true,true);	
			return tmp;
		},
		beforeStop: function(event, ui) {
			// Don't allow resorting in list1... would call cancel here, but there is a jquery 1.7 bug so we
			// need to do the check here but do the cancel in "stop" below. @see http://bugs.jqueryui.com/ticket/6054
			$(this).sortable("option", "selfDrop", $(ui.placeholder).parent()[0] == this);
		},
		stop: function(event, ui) {
			copyHelper && copyHelper.remove();
			
			var $sortable = $(this);
			if ($sortable.sortable("option", "selfDrop")) {
				$sortable.sortable('cancel');
				return;
			}
		}
    }).accordion({
		header: "> li > h3",
		active: false,
		collapsible: true,
		heightStyle: "content",
		autoHeight: true,
		beforeActivate: function (event, ui) {
			var a = ui.newHeader;
			if (ui.newHeader.hasClass("deactivate"))	{
				event.preventDefault();
				event.stopPropagation();
				event.stopImmediatePropagation();
				return false;
			}
		return true;
		}	
	});		
    	
	$("#trash").tooltip({	     
		position: {
			my: "right center",
			at: "left center"
		},
		tooltipClass: "left-tooltip",
		relative: true,
		tracking: true
    }).droppable({			
		drop: function(ev, ui) {
			ui.draggable.remove();			 
		},        
		tolerance: "pointer",
		hoverClass: "trash_highlight"		
	});   
});

$(document).ready(function() {
    $("#savebutton").click(function() {	
		var dataForm1 = $("#form1").serialize();
		var dataForm2 = $("#form2").serialize();
		
        $.post($("#form1").attr("action"), dataForm1 + "&" + dataForm2,
            function() {
				alert('Saved!');
              });
      });
});	
</script>


{% include "footer.html" %}
